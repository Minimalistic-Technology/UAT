services:
  nginx:
    image: nginx:alpine
    container_name: uat-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certbot/www:/var/www/certbot
      - ./certbot/conf:/etc/letsencrypt
    depends_on:
      - gateway
    networks:
      - uat-network
      
  gateway:
    build: ./gateway
    container_name: gateway
    ports:
      - "5000:5000"
    depends_on:
      - ddtec
      - minimalistic-hrm
      - minimalistic-learning
    deploy:
      resources:
        limits:
          cpus: "1.00"     # max 1 core
          memory: 1G
        reservations:
          cpus: "0.25"     # scheduler guarantees at least 0.25 core
          memory: 512M

  ddtec:
    build: ./services/ddtec
    container_name: ddtec
    expose:
      - "5004"
    deploy:
      resources:
        limits:
          cpus: "0.50"
          memory: 512M
        reservations:
          cpus: "0.10"
          memory: 256M

  minimalistic-hrm:
    build: ./services/minimalistic-hrm
    container_name: minimalistic-hrm
    expose:
      - "5002"
    deploy:
      resources:
        limits:
          cpus: "0.50"
          memory: 512M
        reservations:
          cpus: "0.10"
          memory: 256M

  minimalistic-learning:
    build: ./services/minimalistic-learning
    container_name: minimalistic-learning
    expose:
      - "5001"
    deploy:
      resources:
        limits:
          cpus: "0.50"
          memory: 512M
        reservations:
          cpus: "0.10"
          memory: 256M
